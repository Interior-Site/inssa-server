<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inssa.server.api.comment.mapper.CommentMapper">
    <resultMap type="com.inssa.server.api.comment.dto.CommentDto" id="comment_rm">
        <id column="COMMENT_NO" property="commentNo" />
        <result column="PARENT_COMMENT_NO" property="parentCommentNo" />
        <result column="CONTENT" property="content" />
        <result column="DELETE_AT" property="commentStatus" />
        <result column="CREATED_DATE" property="commentRegDate" />
        <result column="MODIFIED_DATE" property="commentChgDate" />
        <result column="BOARD_NO" property="boardNo" />
        <result column="USER_ID" property="userId" />
    </resultMap>

    <!-- 댓글 목록 조회  -->
    <select id="selectList"  resultMap="comment_rm">
        SELECT COMMENT_NO
        , PARENT_COMMENT_NO
        , CONTENT
        , DELETE_AT
        , CREATED_DATE
        , MODIFIED_DATE
        , BOARD_NO
        , USER_ID
        FROM COMMENT
        WHERE BOARD_NO = #{boardNo}
        AND DELETE_AT = '0'
    </select>

    <!-- 댓글 등록 -->
    <insert id="insertComment">
        INSERT INTO COMMENT
            (
            COMMENT_NO,
            PARENT_COMMENT_NO,
            CONTENT,
            DELETE_AT,
            CREATED_DATE,
            MODIFIED_DATE,
            BOARD_NO,
            USER_ID )
        VALUES
            (
            null,
            null, <!--부모 댓글 번호 -->
            #{content},
            default,
            now(), <!-- 작성일 -->
            default, <!-- 수정일 -->
            #{boardNo},
            #{userId} );
    </insert>

    <!-- 대댓글 등록 -->
    <insert id="insertReComment">
        INSERT INTO COMMENT
        (
        COMMENT_NO,
        PARENT_COMMENT_NO,
        CONTENT,
        DELETE_AT,
        CREATED_DATE,
        MODIFIED_DATE,
        BOARD_NO,
        USER_ID )
        VALUES
        (
        null,
        #{parentCommentNo}, <!--부모 댓글 번호 -->
        #{content},
        default,
        now(), <!-- 작성일 -->
        default, <!-- 수정일 -->
        #{boardNo},
        #{userId} );
    </insert>

    <!-- 댓글 수정 -->
    <update id="updateComment">
        UPDATE COMMENT
        SET
        CONTENT = #{content},
        MODIFIED_DATE = NOW()
        WHERE COMMENT_NO = #{commentNo}
        AND USER_ID = #{userId}
    </update>

    <!-- 댓글 삭제 -->
    <update id="deleteComment">
        UPDATE COMMENT
        SET DELETE_AT = '1'
        WHERE COMMENT_NO = #{commentNo}
       AND USER_ID = #{userId}
    </update>
</mapper>